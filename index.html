<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TPL Marari - Consulta de Carrinhos e Display</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <header class="header">
        <img src="logo.svg" alt="Logo TPL" class="logo-img" />
        <h1>TPL Marari - Consulta de Carrinhos e Display</h1>
        <button id="darkModeToggle">
            <span class="icon">🌙</span>
            <span class="label">Modo escuro</span>
        </button>
    </header>

    <div class="main-container">
        <div class="calendar-checkboxes">
            <label class="calendar-checkbox">
                <input type="checkbox" name="calendar" value="af1c95f4ae2831bba53c1cc769e785aefeb836b86a6af22aee8b1d2b73e6e190%40group.calendar.google.com" onchange="selectCalendars()">
                <span class="checkmark"></span>
                <strong>Ponto 1</strong> - Padaria Jd das Oliveiras
            </label>
            <label class="calendar-checkbox">
                <input type="checkbox" name="calendar" value="e34e0be9c80ce654dc03c852e6e3c52af2f53d129295e297861523cbbeff93c2%40group.calendar.google.com" onchange="selectCalendars()">
                <span class="checkmark"></span>
                <strong>Ponto 2</strong> - Mercado P&B | Ponto 5131
            </label>
            <label class="calendar-checkbox">
                <input type="checkbox" name="calendar" value="d6c38e409070037546660123a107f4b95f65681a96c216cac7903d58465f5530%40group.calendar.google.com" onchange="selectCalendars()">
                <span class="checkmark"></span>
                <strong>Ponto 3</strong> - Praça Casa Palma
            </label>
            <label class="calendar-checkbox">
                <input type="checkbox" name="calendar" value="e22e471e522d36c6e1bca2edfcecfbc5ea23c9af8b5b4d10004bf2c7e4b2261f%40group.calendar.google.com" onchange="selectCalendars()">
                <span class="checkmark"></span>
                <strong>Ponto 4</strong> - Padaria Primicia
            </label>
            <label class="calendar-checkbox">
                <input type="checkbox" name="calendar" value="1aa2749c04ae9ac703fa3b2ebbee2db79105711fcda01f98b82da998bc7488ce%40group.calendar.google.com" onchange="selectCalendars()">
                <span class="checkmark"></span>
                <strong>Ponto 5</strong> - Viaduto Washington Luiz
            </label>
        </div>

        <div class="calendar-container">
            <iframe id="calendarIframe" src="" style="width:100%; height:600px; border:none;"></iframe>
        </div>
    </div>

<script>
    // Recupera calendários selecionados do localStorage, ou vazio
    let selectedCalendars = JSON.parse(localStorage.getItem("selectedCalendars") || "[]");

    function updateIframe() {
        const iframe = document.getElementById("calendarIframe");
        const isMobile = window.innerWidth < 768;
        let src = "https://calendar.google.com/calendar/embed?";
        src += "ctz=America%2FSao_Paulo";
        src += "&mode=AGENDA"; // modo lista

        const colorMap = {
            "af1c95f4ae2831bba53c1cc769e785aefeb836b86a6af22aee8b1d2b73e6e190@group.calendar.google.com": "#2952A3", // Azul
            "e34e0be9c80ce654dc03c852e6e3c52af2f53d129295e297861523cbbeff93c2@group.calendar.google.com": "#0D7813", // Verde
            "d6c38e409070037546660123a107f4b95f65681a96c216cac7903d58465f5530@group.calendar.google.com": "#E67C73", // Laranja
            "e22e471e522d36c6e1bca2edfcecfbc5ea23c9af8b5b4d10004bf2c7e4b2261f@group.calendar.google.com": "#B1365F", // Vermelho
            "1aa2749c04ae9ac703fa3b2ebbee2db79105711fcda01f98b82da998bc7488ce@group.calendar.google.com": "#893B90"  // Roxo
        };

        if(selectedCalendars.length === 0) {
            // Nenhum selecionado, limpa iframe
            iframe.src = "";
            return;
        }

        selectedCalendars.forEach(calendar => {
            const cleanCalendar = calendar.replace("%40", "@");
            const color = colorMap[cleanCalendar] || "#2952A3";
            src += "&src=" + calendar + "&color=" + encodeURIComponent(color);
        });

        iframe.src = src;
    }

    function selectCalendars() {
        const checkboxes = document.querySelectorAll('input[name="calendar"]:checked');
        selectedCalendars = Array.from(checkboxes).map(cb => cb.value);
        localStorage.setItem("selectedCalendars", JSON.stringify(selectedCalendars));
        updateIframe();
    }

    window.addEventListener("load", () => {
        // Recarrega seleção do localStorage
        if (selectedCalendars.length) {
            // Marca os checkboxes previamente selecionados
            selectedCalendars.forEach(val => {
                const checkbox = document.querySelector(`input[value="${val}"]`);
                if(checkbox) checkbox.checked = true;
            });
        }
        updateIframe();

        // Dark mode toggle
        const toggleButton = document.getElementById("darkModeToggle");
        const darkMode = localStorage.getItem("darkMode") === "true";

        function applyDarkMode(active) {
            document.body.classList.toggle("dark-mode", active);
            toggleButton.querySelector(".icon").textContent = active ? "☀️" : "🌙";
            toggleButton.querySelector(".label").textContent = active ? "Modo claro" : "Modo escuro";
        }

        toggleButton.addEventListener("click", () => {
            const enabled = document.body.classList.toggle("dark-mode");
            localStorage.setItem("darkMode", enabled);
            applyDarkMode(enabled);
        });

        applyDarkMode(darkMode);
    });
</script>
</body>
</html>
